const topic=document.getElementById("topic"),coursename=document.getElementById("coursename"),coursecode=document.getElementById("coursecode"),sname=document.getElementById("sname"),tname=document.getElementById("tname"),roll=document.getElementById("roll"),subdate=document.getElementById("subdate"),section=document.getElementById("section"),designation=document.getElementById("designation"),department=document.getElementById("department"),download=document.getElementById("download"),canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");let img=new Image;function drawImageWithText(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(img,0,0);let e=processSpecialFormatting(topic.value),t=ctx.measureText(department.value).width,a=1880,n=3220;t>700&&(a=1310,n=3300);let l=ctx.measureText(coursename.value).width+1e3,i=[{text:e,x:950,y:1960,maxWidth:1400,wrap:!0,lineHeight:72,special:!0},{text:coursename.value,x:950,y:2330},{text:coursecode.value,x:l,y:2330},{text:sname.value,x:600,y:2900,maxWidth:630,wrap:!0,lineHeight:72},{text:tname.value,x:1630,y:2900,maxWidth:790,wrap:!0,lineHeight:72},{text:formatDate(subdate.value),x:950,y:2460},{text:roll.value,x:600,y:3095},{text:section.value,x:600,y:3220},{text:designation.value,x:1880,y:3095,maxWidth:500,wrap:!0,lineHeight:60},{text:department.value,x:a,y:n,maxWidth:1500,wrap:!0,lineHeight:60}];ctx.font="normal 72px Arial",ctx.fillStyle="black",ctx.textAlign="left",i.forEach(({text:e,x:t,y:a,maxWidth:n,wrap:l,lineHeight:i,special:c})=>{e&&(c?drawFormattedText(ctx,e,t,a,n,i):l?wrapText(ctx,e,t,a,n,i):ctx.fillText(e,t,a))}),download.style.display="block"}function formatDate(e){if(!e)return"";let t=e.split("-");return`${t[2]}-${t[1]}-${t[0]}`}function processSpecialFormatting(e){return e.replace(/\[br\]/g,"\n").replace(/\[li\]/g,"â€¢ ")}function drawFormattedText(e,t,a,n,l,i){t.split("\n").forEach((t,c)=>{wrapText(e,t,a,n+c*i,l,i)})}function wrapText(e,t,a,n,l,i){let c=t.split(" "),o="",r=[];for(let d=0;d<c.length;d++){let m=o+(o?" ":"")+c[d];e.measureText(m).width>l&&""!==o?(r.push(o),o=c[d]):o=m}r.push(o);for(let $=0;$<r.length;$++)e.fillText(r[$],a,n+$*i)}img.src="./cover.png",img.onload=function(){canvas.width=img.width,canvas.height=img.height,drawImageWithText()},[topic,coursename,coursecode,sname,tname,subdate,roll,section,designation,department].forEach(e=>{e.addEventListener("input",drawImageWithText)}),download.addEventListener("click",function(){let e=document.createElement("a");e.download="custom_image.png",e.href=canvas.toDataURL("image/png"),e.click()});